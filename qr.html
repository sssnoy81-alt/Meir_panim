<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×××™×¨ ×¤× ×™× - ×§×•×“ QR ×©×œ×š</title>
    <meta name="theme-color" content="#8B1538">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: linear-gradient(160deg, #8B1538 0%, #c0392b 50%, #e74c3c 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.35);
            max-width: 420px;
            width: 100%;
            overflow: hidden;
            animation: fadeUp 0.5s ease;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #8B1538, #c0392b);
            padding: 28px 20px 20px;
            text-align: center;
            color: white;
        }

        .heart {
            font-size: 52px;
            display: block;
            margin-bottom: 8px;
            animation: heartbeat 1.5s ease infinite;
        }

        @keyframes heartbeat {
            0%,100% { transform: scale(1); }
            50%      { transform: scale(1.12); }
        }

        .header h1 {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .header p {
            font-size: 13px;
            opacity: 0.85;
            margin-top: 4px;
        }

        /* Warm message */
        .warm-msg {
            background: #fff8f8;
            border-bottom: 1px solid #fde;
            padding: 18px 24px;
            text-align: center;
        }

        .warm-msg .greeting {
            font-size: 20px;
            font-weight: 700;
            color: #8B1538;
            margin-bottom: 6px;
        }

        .warm-msg .subtitle {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        /* Details */
        .details {
            padding: 16px 24px;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 7px 0;
            font-size: 14px;
            border-bottom: 1px dashed #f0f0f0;
        }

        .detail-row:last-child { border-bottom: none; }

        .detail-label { color: #888; }

        .detail-value {
            font-weight: 700;
            color: #333;
        }

        .order-value {
            font-size: 18px;
            color: #8B1538;
            letter-spacing: 2px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
        }

        .order-value:active { opacity: 0.7; }

        /* QR section */
        .qr-section {
            padding: 20px;
            text-align: center;
            background: #fafafa;
        }

        .qr-title {
            font-size: 13px;
            color: #888;
            margin-bottom: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .qr-wrap {
            display: inline-block;
            background: white;
            border-radius: 16px;
            padding: 14px;
            box-shadow: 0 4px 20px rgba(139,21,56,0.15);
            border: 2px solid #f5e0e5;
        }

        #qrCanvas { display: block; }

        /* Instructions */
        .instructions {
            padding: 16px 24px 20px;
            background: white;
        }

        .inst-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #555;
            line-height: 1.5;
        }

        .inst-item:last-child { margin-bottom: 0; }

        .inst-icon {
            font-size: 18px;
            flex-shrink: 0;
            margin-top: 1px;
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, #8B1538, #c0392b);
            padding: 14px;
            text-align: center;
            color: rgba(255,255,255,0.8);
            font-size: 12px;
        }

        /* Copy toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: #333;
            color: white;
            padding: 10px 24px;
            border-radius: 50px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.3s;
            pointer-events: none;
            z-index: 999;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body>

<div class="toast" id="toast">âœ“ ×”×•×¢×ª×§!</div>

<div class="card">

    <!-- Header -->
    <div class="header">
        <span class="heart">â¤ï¸</span>
        <h1>×××™×¨ ×¤× ×™×</h1>
        <p>×‘×™×ª ×ª××—×•×™ ×œ×¡×™×•×¢ ×œ× ×–×§×§×™×</p>
    </div>

    <!-- Warm message -->
    <div class="warm-msg">
        <div class="greeting" id="greetingText">×”×¨×©××ª×š ×”×ª×§×‘×œ×” ×‘×”×¦×œ×—×”!</div>
        <div class="subtitle">
            ×× ×• ×©××—×™× ×œ×¡×™×™×¢ ×œ×š ×•×œ××©×¤×—×ª×š.<br>
            ×©××•×¨ ××ª ×”×§×•×“ ×”×–×” ×œ×¦×•×¨×š ×§×‘×œ×ª ×”×—×‘×™×œ×”.
        </div>
    </div>

    <!-- Details -->
    <div class="details">
        <div class="detail-row" id="nameRow" style="display:none;">
            <span class="detail-label">×©×:</span>
            <span class="detail-value" id="nameVal"></span>
        </div>
        <div class="detail-row" id="cityRow" style="display:none;">
            <span class="detail-label">×¡× ×™×£:</span>
            <span class="detail-value" id="cityVal"></span>
        </div>
        <div class="detail-row">
            <span class="detail-label">××¡×¤×¨ ×”×–×× ×”:</span>
            <span class="detail-value order-value" id="orderVal" onclick="copyOrder()" title="×œ×—×¥ ×œ×”×¢×ª×§×”">-</span>
        </div>
    </div>

    <!-- QR -->
    <div class="qr-section">
        <div class="qr-title">ğŸ“± ×§×•×“ QR ×œ×–×™×”×•×™</div>
        <div class="qr-wrap">
            <canvas id="qrCanvas" width="220" height="220"></canvas>
        </div>
    </div>

    <!-- Instructions -->
    <div class="instructions">
        <div class="inst-item">
            <span class="inst-icon">ğŸ“²</span>
            <span>×”×¦×’ ×§×•×“ QR ×–×” ×œ×× ×”×œ ×”×—×œ×•×§×” ×‘×¢×ª ×”×’×¢×ª×š</span>
        </div>
        <div class="inst-item">
            <span class="inst-icon">ğŸ”–</span>
            <span>×©××•×¨ ××ª ×”×§×™×©×•×¨ ××”-SMS ×œ×’×™×©×” ××”×™×¨×” ×‘×›×œ ×¢×ª</span>
        </div>
        <div class="inst-item">
            <span class="inst-icon">ğŸ’›</span>
            <span>×××™×¨ ×¤× ×™× ×“×•××’×™× ×œ×›× - ×—×’ ×©××—!</span>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        ×¢××•×ª×ª ×××™×¨ ×¤× ×™× Â© | ×¡×™×•×¢ ×œ× ×–×§×§×™× ×‘×™×©×¨××œ
    </div>

</div>

<!-- QR ××•×‘× ×” ×œ×—×œ×•×˜×™×Ÿ -->
<script>
var QRGen=(function(){
var ALPHANUM='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:';
function pb(arr,val,len){for(var i=len-1;i>=0;i--)arr.push((val>>i)&1);}
function alphaEnc(s){
    s=s.toUpperCase();var bits=[];
    for(var i=0;i<s.length-1;i+=2){pb(bits,ALPHANUM.indexOf(s[i])*45+ALPHANUM.indexOf(s[i+1]),11);}
    if(s.length%2===1)pb(bits,ALPHANUM.indexOf(s[s.length-1]),6);
    return bits;
}
var EX=new Array(512),LG=new Array(256);
(function(){var x=1;for(var i=0;i<255;i++){EX[i]=x;LG[x]=i;x<<=1;if(x&256)x^=285;}for(var i=255;i<512;i++)EX[i]=EX[i-255];})();
function gm(a,b){return a&&b?EX[LG[a]+LG[b]]:0;}
function rsGen(n){var g=[1];for(var i=0;i<n;i++){var ng=new Array(g.length+1).fill(0);for(var j=0;j<g.length;j++){ng[j]^=g[j];ng[j+1]^=gm(g[j],EX[i]);}g=ng;}return g;}
function rsEnc(data,ec){
    var gen=rsGen(ec),msg=data.slice();
    for(var i=0;i<ec;i++)msg.push(0);
    for(var i=0;i<data.length;i++){var c=msg[i];if(c)for(var j=1;j<gen.length;j++)msg[i+j]^=gm(gen[j],c);}
    return msg.slice(data.length);
}
function b2B(bits){while(bits.length%8!==0)bits.push(0);var B=[];for(var i=0;i<bits.length;i+=8){var b=0;for(var j=0;j<8;j++)b=(b<<1)|bits[i+j];B.push(b);}return B;}
function buildMatrix(text){
    var N=25,M=[];
    for(var i=0;i<N;i++)M.push(new Array(N).fill(-1));
    function finder(r,c){for(var i=0;i<7;i++)for(var j=0;j<7;j++)M[r+i][c+j]=(i===0||i===6||j===0||j===6||(i>=2&&i<=4&&j>=2&&j<=4))?1:0;}
    finder(0,0);finder(0,18);finder(18,0);
    for(var i=0;i<8;i++){M[7][i]=0;M[7][N-1-i]=0;M[N-8][i]=0;M[i][7]=0;M[N-1-i][7]=0;M[i][N-8]=0;}
    M[7][7]=0;M[7][N-8]=0;M[N-8][7]=0;
    for(var i=8;i<N-8;i++){M[6][i]=i%2===0?1:0;M[i][6]=i%2===0?1:0;}
    M[N-8][8]=1;
    function align(r,c){for(var i=-2;i<=2;i++)for(var j=-2;j<=2;j++)M[r+i][c+j]=(Math.abs(i)===2||Math.abs(j)===2)?1:(i===0&&j===0?1:0);}
    align(18,18);
    for(var i=0;i<9;i++){if(M[8][i]===-1)M[8][i]=0;if(M[i][8]===-1)M[i][8]=0;}
    for(var i=0;i<8;i++){if(M[8][N-1-i]===-1)M[8][N-1-i]=0;if(M[N-1-i][8]===-1)M[N-1-i][8]=0;}
    var bits=[0,0,1,0];
    pb(bits,text.length,9);
    bits=bits.concat(alphaEnc(text));
    for(var i=0;i<4&&bits.length<224;i++)bits.push(0);
    while(bits.length%8!==0)bits.push(0);
    var pad=[0xEC,0x11],pi=0;
    while(bits.length<224){pb(bits,pad[pi%2],8);pi++;}
    var dB=b2B(bits),eB=rsEnc(dB,16),aB=dB.concat(eB),aBI=[];
    for(var i=0;i<aB.length;i++)pb(aBI,aB[i],8);
    var bi=0,dir=-1;
    for(var col=N-1;col>=0;col-=2){
        if(col===6)col=5;
        for(var rs=0;rs<N;rs++){
            var r=dir===-1?(N-1-rs):rs;
            for(var ci=0;ci<2;ci++){
                var c=col-ci;
                if(M[r][c]===-1){var bit=bi<aBI.length?aBI[bi++]:0;M[r][c]=((r+c)%2===0)?(bit^1):bit;}
            }
        }
        dir=-dir;
    }
    var fmt=[1,0,1,0,1,0,0,0,0,0,1,0,0,1,0];
    var fp1=[[8,0],[8,1],[8,2],[8,3],[8,4],[8,5],[8,7],[8,8],[7,8],[5,8],[4,8],[3,8],[2,8],[1,8],[0,8]];
    var fp2=[[N-1,8],[N-2,8],[N-3,8],[N-4,8],[N-5,8],[N-6,8],[N-7,8],[8,N-8],[8,N-7],[8,N-6],[8,N-5],[8,N-4],[8,N-3],[8,N-2],[8,N-1]];
    for(var i=0;i<15;i++){M[fp1[i][0]][fp1[i][1]]=fmt[i];M[fp2[i][0]][fp2[i][1]]=fmt[i];}
    return M;
}
return{
    draw:function(canvasId,text,opts){
        opts=opts||{};
        var dark=opts.dark||'#000',light=opts.light||'#fff',size=opts.size||220;
        var M=buildMatrix(text.toUpperCase()),N=M.length;
        var cv=document.getElementById(canvasId);
        cv.width=size;cv.height=size;
        var ctx=cv.getContext('2d');
        var cell=size/(N+8),off=cell*4;
        ctx.fillStyle=light;ctx.fillRect(0,0,size,size);
        ctx.fillStyle=dark;
        for(var r=0;r<N;r++)for(var c=0;c<N;c++)
            if(M[r][c]===1)ctx.fillRect(Math.floor(off+c*cell),Math.floor(off+r*cell),Math.ceil(cell),Math.ceil(cell));
    }
};
})();

// ============================
// Init - ×§×¨× ×¤×¨××˜×¨×™× ××”-URL
// ============================
(function init() {
    const p = new URLSearchParams(window.location.search);
    const orderId = p.get('id') || p.get('order') || '';
    const name    = p.get('name') || '';
    const city    = p.get('city') || '';

    // ×”×¦×’ ××¡×¤×¨ ×”×–×× ×”
    if (orderId) {
        document.getElementById('orderVal').textContent = orderId;
    }

    // ×©×
    if (name) {
        document.getElementById('nameVal').textContent = decodeURIComponent(name);
        document.getElementById('nameRow').style.display = 'flex';
        document.getElementById('greetingText').textContent = '×©×œ×•× ' + decodeURIComponent(name) + '! ğŸ‘‹';
    }

    // ×¢×™×¨
    if (city) {
        document.getElementById('cityVal').textContent = decodeURIComponent(city);
        document.getElementById('cityRow').style.display = 'flex';
    }

    // ×¦×™×™×¨ QR
    if (orderId) {
        try {
            QRGen.draw('qrCanvas', orderId, { dark: '#8B1538', light: '#FFFFFF', size: 220 });
        } catch(e) {
            document.getElementById('qrCanvas').outerHTML =
                '<p style="padding:10px;color:#c0392b;">××¡×¤×¨ ×”×–×× ×”: ' + orderId + '</p>';
        }
    } else {
        document.getElementById('qrCanvas').outerHTML =
            '<p style="padding:10px;color:#999;font-size:13px;">×œ× × ××¦× ××¡×¤×¨ ×”×–×× ×”</p>';
    }
})();

// ×”×¢×ª×§×ª ××¡×¤×¨ ×”×–×× ×”
function copyOrder() {
    const val = document.getElementById('orderVal').textContent;
    if (navigator.clipboard) {
        navigator.clipboard.writeText(val).then(showToast);
    } else {
        const el = document.createElement('textarea');
        el.value = val; document.body.appendChild(el);
        el.select(); document.execCommand('copy');
        document.body.removeChild(el); showToast();
    }
}

function showToast() {
    const t = document.getElementById('toast');
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2000);
}
</script>
</body>
</html>
