<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>בדיקת הזמנה – מאיר פנים</title>

  <style>
    body{
      font-family: Arial, Helvetica, sans-serif;
      background:#f4f6f9;
      margin:0;
      padding:24px;
    }

    .card{
      max-width:520px;
      margin:0 auto;
      background:#ffffff;
      border-radius:18px;
      padding:24px;
      box-shadow:0 12px 30px rgba(0,0,0,.08);
      text-align:center;
    }

    h1{
      margin:0 0 12px;
      font-size:24px;
    }

    .code{
      font-weight:700;
      font-size:20px;
      color:#333;
    }

    .status{
      margin-top:18px;
      padding:16px;
      border-radius:14px;
      font-size:19px;
      line-height:1.5;
      font-weight:600;
    }

    .ok{
      background:#eaffea;
      border:1px solid #9fe39f;
      color:#0a7a0a;
    }

    .bad{
      background:#ffecec;
      border:1px solid #f3a3a3;
      color:#b30000;
    }

    .info{
      background:#eef4ff;
      border:1px solid #a8c3ff;
      color:#1a3fa3;
    }

    button{
      margin-top:18px;
      width:100%;
      padding:14px;
      border:0;
      border-radius:12px;
      font-size:16px;
      cursor:pointer;
      background:#1a73e8;
      color:#fff;
      font-weight:600;
    }

    button:hover{
      background:#155ec2;
    }

    .small{
      margin-top:14px;
      font-size:12px;
      color:#666;
      word-break:break-word;
    }
  </style>
</head>
<body>

<div class="card">
  <h1>בדיקת זכאות – מאיר פנים</h1>

  <div>
    קוד הזמנה:
    <div class="code" id="codeText">...</div>
  </div>

  <div id="box" class="status info">בודק זכאות…</div>

  <button onclick="location.reload()">בדיקה מחדש</button>

  <div id="raw" class="small"></div>
</div>

<script>
/* =====================================
   ⚙️ הגדרת ה-Worker שלך
===================================== */
const WORKER_URL = "https://meir-panim-sms.sssnoy81.workers.dev";

/* =====================================
   קריאת הקוד מה-QR
===================================== */
const params = new URLSearchParams(location.search);
const code = (params.get("code") || "").trim();

document.getElementById("codeText").textContent =
  code || "לא נמצא קוד";

/* =====================================
   פונקציה ראשית
===================================== */
async function run() {
  const box = document.getElementById("box");
  const raw = document.getElementById("raw");

  if (!code) {
    box.className = "status bad";
    box.textContent = "❌ חסר קוד בקישור.";
    return;
  }

  try {
    const url = `${WORKER_URL}/verify?code=${encodeURIComponent(code)}`;

    const res = await fetch(url, {
      method: "GET",
      headers: { "Accept": "application/json" }
    });

    const data = await res.json();

    raw.textContent = "DEBUG: " + JSON.stringify(data);

    if (data.ok === true) {
      box.className = "status ok";
      box.textContent = "✅ אושר — ניתן לחלק ללקוח";
    } else {
      box.className = "status bad";
      box.textContent = "❌ לא תקין / כבר נוצל";
    }

  } catch (err) {
    box.className = "status bad";
    box.textContent = "⚠️ שגיאת תקשורת עם השרת";
    raw.textContent = String(err);
  }
}

/* ===================================== */
run();
</script>

</body>
</html>
