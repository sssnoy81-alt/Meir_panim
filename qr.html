<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×™×ª ×ª××—×•×™ ×××™×¨ ×¤× ×™× - ×¨×™×©×•× ××©×¤×—×•×ª</title>
    <meta name="description" content="××¢×¨×›×ª ×¨×™×©×•× ××©×¤×—×•×ª - ×‘×™×ª ×ª××—×•×™ ×××™×¨ ×¤× ×™×">
    <meta name="theme-color" content="#c0392b">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon.png">

    <!-- QR Code library - works offline, no external API needed -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', 'Arial Hebrew', Arial, sans-serif;
            background: linear-gradient(135deg, #8B0000 0%, #c0392b 40%, #e74c3c 70%, #ff6b6b 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #8B0000, #c0392b);
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .content {
            padding: 30px 25px;
            text-align: center;
        }

        .success-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #e8f5e9;
            border: 2px solid #4CAF50;
            border-radius: 50px;
            padding: 10px 25px;
            margin-bottom: 25px;
            font-size: 18px;
            color: #2e7d32;
            font-weight: bold;
        }

        .success-badge .checkmark {
            font-size: 22px;
        }

        .order-section {
            border: 2px solid #8B0000;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            background: #fafafa;
        }

        .order-label {
            color: #555;
            font-size: 14px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .order-number {
            font-size: 32px;
            font-weight: bold;
            color: #8B0000;
            letter-spacing: 2px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            user-select: all;
        }

        .order-number:hover {
            background: #fff3f3;
            border-radius: 6px;
        }

        .copy-hint {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        .qr-section {
            margin: 20px 0;
        }

        .qr-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 12px;
        }

        #qrcode {
            display: inline-block;
            padding: 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        #qrcode img,
        #qrcode canvas {
            display: block;
        }

        .qr-error {
            color: #e74c3c;
            font-size: 13px;
            padding: 10px;
            background: #fff5f5;
            border-radius: 8px;
            border: 1px solid #fcc;
        }

        .instructions {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: right;
        }

        .instruction-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #444;
        }

        .instruction-item:last-child {
            margin-bottom: 0;
        }

        .instruction-icon {
            font-size: 16px;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .sms-section {
            margin-top: 20px;
            padding: 12px;
            background: #e8f5e9;
            border-radius: 10px;
            font-size: 14px;
            color: #2e7d32;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* Client info display */
        .client-info {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: right;
        }

        .client-info-title {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .client-info-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #333;
            padding: 3px 0;
            border-bottom: 1px solid #e0e8ff;
        }

        .client-info-row:last-child {
            border-bottom: none;
        }

        .client-info-value {
            font-weight: bold;
            color: #8B0000;
        }

        .actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 22px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #8B0000;
            color: white;
        }

        .btn-primary:hover {
            background: #6b0000;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-print {
            background: #2196F3;
            color: white;
        }

        .btn-print:hover {
            background: #1565C0;
        }

        .footer-note {
            margin-top: 25px;
            font-size: 12px;
            color: #999;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        /* Copied tooltip */
        .copied-msg {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 9999;
        }

        .copied-msg.show {
            opacity: 1;
        }

        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; border-radius: 0; }
            .actions { display: none; }
            .header { background: #8B0000 !important; -webkit-print-color-adjust: exact; }
        }

        @media (max-width: 480px) {
            .order-number { font-size: 26px; }
            .content { padding: 20px 15px; }
        }
    </style>
</head>
<body>

<div class="copied-msg" id="copiedMsg">âœ“ ×”×•×¢×ª×§ ×œ×œ×•×—</div>

<div class="container">
    <div class="header">
        ğŸ² ×‘×™×ª ×ª××—×•×™ ×××™×¨ ×¤× ×™×
    </div>

    <div class="content">

        <!-- Success Badge -->
        <div class="success-badge">
            <span class="checkmark">âœ…</span>
            <span>× ×¨×©××ª ×‘×”×¦×œ×—×”!</span>
        </div>

        <!-- Client Info (filled dynamically) -->
        <div class="client-info" id="clientInfoSection" style="display:none;">
            <div class="client-info-title">×¤×¨×˜×™ ×”×¨×™×©×•×:</div>
            <div class="client-info-row">
                <span>×©×:</span>
                <span class="client-info-value" id="clientName">-</span>
            </div>
            <div class="client-info-row">
                <span>×¡× ×™×£:</span>
                <span class="client-info-value" id="clientBranch">-</span>
            </div>
            <div class="client-info-row">
                <span>×¡×•×’ ×—×‘×™×œ×”:</span>
                <span class="client-info-value" id="clientPackage">-</span>
            </div>
            <div class="client-info-row">
                <span>×ª××¨×™×š ×¨×™×©×•×:</span>
                <span class="client-info-value" id="clientDate">-</span>
            </div>
        </div>

        <!-- Order Number -->
        <div class="order-section">
            <div class="order-label">
                ğŸ“‹ ××¡×¤×¨ ×”×”×–×× ×” ×©×œ×š
            </div>
            <div class="order-number" id="orderNumber" onclick="copyOrderNumber()" title="×œ×—×¥ ×œ×”×¢×ª×§×”">
                ×˜×•×¢×Ÿ...
            </div>
            <div class="copy-hint">×œ×—×¥ ×œ×”×¢×ª×§×”</div>
        </div>

        <!-- QR Code -->
        <div class="qr-section">
            <div class="qr-label">ğŸ“± ×§×•×“ QR ×œ×–×™×”×•×™ ××”×™×¨</div>
            <div id="qrcode"></div>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <div class="instruction-item">
                <span class="instruction-icon">ğŸ“±</span>
                <span>×”×¦×’ ×§×•×“ QR ×–×” ×œ×× ×”×œ ×”×—×œ×•×§×” ×‘×¢×ª ×§×‘×œ×ª ×”×—×‘×™×œ×”</span>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">ğŸ’¾</span>
                <span>×©××•×¨ ××ª ××¡×¤×¨ ×”×”×–×× ×” ×©×œ×š ×œ×¦×•×¨×š ××¢×§×‘ ×¢×ª×™×“×™</span>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">ğŸ“</span>
                <span>×œ×›×œ ×©××œ×” ×¤× ×” ×œ×¡× ×™×£ ×”×§×¨×•×‘ ××œ×™×š</span>
            </div>
        </div>

        <!-- SMS Confirmation -->
        <div class="sms-section" id="smsSection" style="display:none;">
            âœ… SMS × ×©×œ×— ×œ×˜×œ×¤×•×Ÿ ×©×œ×š
        </div>

        <!-- Action Buttons -->
        <div class="actions">
            <button class="btn btn-primary" onclick="shareQR()">
                ğŸ“¤ ×©×ª×£
            </button>
            <button class="btn btn-print" onclick="window.print()">
                ğŸ–¨ï¸ ×”×“×¤×¡
            </button>
            <button class="btn btn-secondary" onclick="goHome()">
                ğŸ  ×—×–×¨×” ×œ×“×£ ×”×‘×™×ª
            </button>
        </div>

        <div class="footer-note">
            ×××™×¨ ×¤× ×™× - ×¢××•×ª×” ×œ×¡×™×•×¢ ×œ× ×–×§×§×™× ×‘×™×©×¨××œ<br>
            <small id="timestampDisplay"></small>
        </div>

    </div>
</div>

<script>
    // ============================
    // Read URL parameters
    // ============================
    function getParams() {
        const params = new URLSearchParams(window.location.search);
        return {
            orderNumber: params.get('order') || params.get('orderNumber') || params.get('id'),
            name: params.get('name'),
            branch: params.get('branch'),
            packageType: params.get('package') || params.get('packageType'),
            phone: params.get('phone'),
            smsSent: params.get('sms') === 'true' || params.get('smsSent') === 'true'
        };
    }

    // ============================
    // Generate QR Code
    // ============================
    function generateQR(text) {
        const container = document.getElementById('qrcode');
        container.innerHTML = '';

        try {
            new QRCode(container, {
                text: text,
                width: 200,
                height: 200,
                colorDark: '#8B0000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });
        } catch (e) {
            container.innerHTML = '<div class="qr-error">âš ï¸ ×©×’×™××” ×‘×™×¦×™×¨×ª ×§×•×“ QR<br><small>' + e.message + '</small></div>';
        }
    }

    // ============================
    // Copy order number
    // ============================
    function copyOrderNumber() {
        const num = document.getElementById('orderNumber').textContent.trim();
        if (navigator.clipboard && num !== '×˜×•×¢×Ÿ...') {
            navigator.clipboard.writeText(num).then(() => showCopied());
        } else {
            // Fallback
            const el = document.createElement('textarea');
            el.value = num;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showCopied();
        }
    }

    function showCopied() {
        const msg = document.getElementById('copiedMsg');
        msg.classList.add('show');
        setTimeout(() => msg.classList.remove('show'), 2000);
    }

    // ============================
    // Share
    // ============================
    function shareQR() {
        const orderNum = document.getElementById('orderNumber').textContent.trim();
        const text = `××¡×¤×¨ ×”×–×× ×” ×××™×¨ ×¤× ×™×: ${orderNum}`;
        
        if (navigator.share) {
            navigator.share({
                title: '×××™×¨ ×¤× ×™× - ××™×©×•×¨ ×¨×™×©×•×',
                text: text,
                url: window.location.href
            });
        } else {
            copyOrderNumber();
            alert('×”×§×™×©×•×¨ ×”×•×¢×ª×§ ×œ×œ×•×—');
        }
    }

    // ============================
    // Go home
    // ============================
    function goHome() {
        window.location.href = 'index.html';
    }

    // ============================
    // Init
    // ============================
    function init() {
        const p = getParams();

        // Order number
        let orderNum = p.orderNumber;
        
        // If no order number in URL, check localStorage (set by registration page)
        if (!orderNum) {
            orderNum = localStorage.getItem('lastOrderNumber') || 
                       localStorage.getItem('orderNumber') ||
                       sessionStorage.getItem('orderNumber');
        }

        if (orderNum) {
            document.getElementById('orderNumber').textContent = orderNum;
            generateQR(orderNum);
        } else {
            // Generate a placeholder if nothing found
            const fallback = 'MP' + Math.floor(10000000 + Math.random() * 89999999);
            document.getElementById('orderNumber').textContent = fallback;
            generateQR(fallback);
        }

        // Client info
        if (p.name || p.branch || p.packageType) {
            document.getElementById('clientInfoSection').style.display = 'block';
            if (p.name) document.getElementById('clientName').textContent = p.name;
            if (p.branch) document.getElementById('clientBranch').textContent = p.branch;
            if (p.packageType) document.getElementById('clientPackage').textContent = p.packageType;
        }

        // Also try localStorage for client info
        const storedName = localStorage.getItem('clientName') || sessionStorage.getItem('clientName');
        const storedBranch = localStorage.getItem('clientBranch') || sessionStorage.getItem('clientBranch');
        const storedPackage = localStorage.getItem('clientPackage') || sessionStorage.getItem('clientPackage');
        
        if (storedName || storedBranch || storedPackage) {
            document.getElementById('clientInfoSection').style.display = 'block';
            if (storedName) document.getElementById('clientName').textContent = storedName;
            if (storedBranch) document.getElementById('clientBranch').textContent = storedBranch;
            if (storedPackage) document.getElementById('clientPackage').textContent = storedPackage;
        }

        // Date
        const now = new Date();
        const dateStr = now.toLocaleDateString('he-IL', { 
            day: '2-digit', month: '2-digit', year: 'numeric',
            hour: '2-digit', minute: '2-digit'
        });
        document.getElementById('clientDate').textContent = dateStr;
        document.getElementById('timestampDisplay').textContent = '× ×¨×©× ×‘×ª××¨×™×š: ' + dateStr;

        // SMS
        if (p.smsSent) {
            document.getElementById('smsSection').style.display = 'flex';
        }
    }

    // Run on load
    window.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
